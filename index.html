<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>حكايتنا - تسجيل الدخول</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #ff3b3b; /* أحمر ناري */
            --secondary-color: #ff8c00; /* برتقالي حيوي */
            --dark-bg-main: #0a0a0a; /* أسود عميق جداً */
            --dark-bg-secondary: #1a1a1a;
            --card-bg: #1f1f1f;
            --text-light: #f0f0f0;
            --text-muted: #aaaaaa;
            --border-color: #444444;
            --shadow-dark: rgba(0,0,0,0.9);
            --glow-primary: rgba(255, 59, 59, 0.7);
        }

        body {
            font-family: 'Cairo', sans-serif;
            background: linear-gradient(145deg, var(--dark-bg-main), #100000);
            color: var(--text-light);
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            direction: rtl;
            overflow: hidden; /* Prevent scroll for animations */
        }

        /* Background Animation */
        .background-circles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 0;
        }
        .background-circles li {
            position: absolute;
            display: block;
            list-style: none;
            width: 20px;
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            animation: animate 25s linear infinite;
            bottom: -150px;
        }
        .background-circles li:nth-child(1) {
            left: 25%;
            width: 80px;
            height: 80px;
            animation-delay: 0s;
        }
        .background-circles li:nth-child(2) {
            left: 10%;
            width: 20px;
            height: 20px;
            animation-delay: 2s;
            animation-duration: 12s;
        }
        .background-circles li:nth-child(3) {
            left: 70%;
            width: 20px;
            height: 20px;
            animation-delay: 4s;
        }
        .background-circles li:nth-child(4) {
            left: 40%;
            width: 60px;
            height: 60px;
            animation-delay: 0s;
            animation-duration: 18s;
        }
        .background-circles li:nth-child(5) {
            left: 65%;
            width: 20px;
            height: 20px;
            animation-delay: 0s;
        }
        .background-circles li:nth-child(6) {
            left: 75%;
            width: 110px;
            height: 110px;
            animation-delay: 3s;
        }
        .background-circles li:nth-child(7) {
            left: 35%;
            width: 150px;
            height: 150px;
            animation-delay: 7s;
        }
        .background-circles li:nth-child(8) {
            left: 50%;
            width: 25px;
            height: 25px;
            animation-delay: 15s;
            animation-duration: 45s;
        }
        .background-circles li:nth-child(9) {
            left: 20%;
            width: 15px;
            height: 15px;
            animation-delay: 2s;
            animation-duration: 35s;
        }
        .background-circles li:nth-child(10) {
            left: 85%;
            width: 150px;
            height: 150px;
            animation-delay: 0s;
            animation-duration: 11s;
        }
        @keyframes animate {
            0% {
                transform: translateY(0) rotate(0deg);
                opacity: 1;
                border-radius: 0;
            }
            100% {
                transform: translateY(-1000px) rotate(720deg);
                opacity: 0;
                border-radius: 50%;
            }
        }

        .login-container {
            position: relative;
            z-index: 1;
            background: var(--card-bg);
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 15px 40px var(--shadow-dark);
            text-align: center;
            width: 380px;
            max-width: 90%;
            animation: fadeInScale 0.8s ease-out forwards;
            border: 1px solid var(--border-color);
        }

        @keyframes fadeInScale {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        h1 {
            color: var(--primary-color);
            margin-bottom: 30px;
            font-size: 32px;
            text-shadow: 0 0 12px var(--glow-primary);
        }

        .social-login-buttons button {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        .social-login-buttons button img {
            width: 24px;
            height: 24px;
            margin-inline-end: 15px;
        }

        .social-login-buttons .google-btn {
            background-color: #4285F4;
        }
        .social-login-buttons .google-btn:hover {
            background-color: #357ae8;
            transform: translateY(-2px);
        }

        .social-login-buttons .facebook-btn {
            background-color: #1877F2;
        }
        .social-login-buttons .facebook-btn:hover {
            background-color: #1a6dcc;
            transform: translateY(-2px);
        }

        .social-login-buttons .twitter-btn {
            background-color: #1DA1F2;
        }
        .social-login-buttons .twitter-btn:hover {
            background-color: #1a94da;
            transform: translateY(-2px);
        }

        .separator {
            margin: 25px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-muted);
            font-size: 14px;
        }
        .separator::before,
        .separator::after {
            content: '';
            flex-grow: 1;
            height: 1px;
            background-color: var(--border-color);
            margin: 0 10px;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: start;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-light);
            font-weight: bold;
        }

        .form-group input {
            width: calc(100% - 24px); /* Adjust for padding and border */
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background-color: #222;
            color: var(--text-light);
            font-size: 16px;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
        }
        .form-group input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(255, 59, 59, 0.3);
        }

        .auth-buttons button {
            width: 100%;
            padding: 12px;
            margin-top: 10px;
            border: none;
            border-radius: 8px;
            font-size: 17px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            color: white;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        .auth-buttons #login-btn {
            background-color: var(--primary-color);
        }
        .auth-buttons #login-btn:hover {
            background-color: #cc2a2a;
            transform: translateY(-2px);
        }

        .auth-buttons #register-btn {
            background-color: var(--secondary-color);
            margin-bottom: 15px;
        }
        .auth-buttons #register-btn:hover {
            background-color: #cc7400;
            transform: translateY(-2px);
        }

        .toggle-form-link {
            display: block;
            margin-top: 20px;
            color: var(--secondary-color);
            text-decoration: none;
            font-size: 14px;
            transition: color 0.3s ease;
        }
        .toggle-form-link:hover {
            color: #ff6a00;
            text-decoration: underline;
        }

        #loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            flex-direction: column;
            gap: 20px;
            color: var(--text-light);
            font-size: 20px;
            animation: fadeEffect 0.5s ease-in-out forwards;
        }

        @keyframes fadeEffect {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .loader {
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-top: 5px solid var(--primary-color);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            color: #dc3545;
            margin-top: 15px;
            font-size: 14px;
            text-align: center;
            animation: slideIn 0.3s ease-out forwards;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <ul class="background-circles">
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
        <li></li>
    </ul>

    <div class="login-container">
        <h1>تسجيل الدخول إلى حكايتنا</h1>

        <div class="social-login-buttons">
            <button id="google-login-btn" class="google-btn">
                <img src="https://img.icons8.com/color/48/000000/google-logo.png" alt="Google">
                تسجيل الدخول عبر جوجل
            </button>
            <button id="facebook-login-btn" class="facebook-btn">
                <img src="https://img.icons8.com/color/48/000000/facebook-new.png" alt="Facebook">
                تسجيل الدخول عبر فيسبوك
            </button>
            <button id="twitter-login-btn" class="twitter-btn">
                <img src="https://img.icons8.com/color/48/000000/twitterx--v1.png" alt="X (Twitter)">
                تسجيل الدخول عبر X (تويتر)
            </button>
        </div>

        <div class="separator">أو</div>

        <div id="email-password-form">
            <div class="form-group">
                <label for="email">البريد الإلكتروني:</label>
                <input type="email" id="email" placeholder="أدخل بريدك الإلكتروني" required>
            </div>
            <div class="form-group">
                <label for="password">كلمة المرور:</label>
                <input type="password" id="password" placeholder="أدخل كلمة المرور" required>
            </div>
            <div class="auth-buttons">
                <button id="login-btn">تسجيل الدخول</button>
                <button id="register-btn" style="display: none;">إنشاء حساب</button>
            </div>
            <a href="#" id="toggle-register-login" class="toggle-form-link">ليس لديك حساب؟ إنشاء حساب جديد</a>
            <div id="auth-error-message" class="error-message" style="display: none;"></div>
        </div>
    </div>

    <div id="loading-overlay" style="display: none;">
        <div class="loader"></div>
        <p>جاري التحقق من تسجيل الدخول...</p>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js";
        import { 
            getAuth, 
            signInWithEmailAndPassword, 
            createUserWithEmailAndPassword, 
            GoogleAuthProvider, 
            FacebookAuthProvider, 
            TwitterAuthProvider, 
            signInWithPopup, 
            onAuthStateChanged 
        } from "https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js";

        // Firebase configuration (Ensure this matches your Firebase project)
        const firebaseConfig = {
            apiKey: "AIzaSyCEaxXR5eqzg0e5JvjWAFjZ5ZeMraMYREn", // REPLACE WITH YOUR ACTUAL API KEY
            authDomain: "mo-play-b0cb7.firebaseapp.com", // REPLACE WITH YOUR ACTUAL AUTH DOMAIN
            databaseURL: "https://mo-play-b0cb7-default-rtdb.firebaseio.com", // REPLACE WITH YOUR ACTUAL DATABASE URL
            projectId: "mo-play-b0cb7", // REPLACE WITH YOUR ACTUAL PROJECT ID
            storageBucket: "mo-play-b0cb7.firebasestorage.app", // REPLACE WITH YOUR ACTUAL STORAGE BUCKET
            messagingSenderId: "575424024738", // REPLACE WITH YOUR ACTUAL MESSAGING SENDER ID
            appId: "1:575424024738:web:0b1736c0c2e496adf607fb", // REPLACE WITH YOUR ACTUAL APP ID
            measurementId: "G-33QRGFTW30" // REPLACE WITH YOUR ACTUAL MEASUREMENT ID (optional)
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        // UI Elements
        const emailInput = document.getElementById('email');
        const passwordInput = document.getElementById('password');
        const loginBtn = document.getElementById('login-btn');
        const registerBtn = document.getElementById('register-btn');
        const toggleFormLink = document.getElementById('toggle-register-login');
        const googleLoginBtn = document.getElementById('google-login-btn');
        const facebookLoginBtn = document.getElementById('facebook-login-btn');
        const twitterLoginBtn = document.getElementById('twitter-login-btn');
        const authErrorMessage = document.getElementById('auth-error-message');
        const loadingOverlay = document.getElementById('loading-overlay');

        let isRegisterMode = false; // To toggle between login and register forms

        // --- Authentication State Listener ---
        // This listens for any change in the user's sign-in state.
        // If a user logs in successfully, it redirects them.
        onAuthStateChanged(auth, (user) => {
            if (user) {
                // User is signed in, redirect to admin panel
                console.log("User is signed in:", user.uid);
                window.location.href = 'index.html'; // Redirect to your admin panel
            } else {
                // No user is signed in. Keep the login page visible.
                loadingOverlay.style.display = 'none'; // Hide loading overlay once state is determined
            }
        });

        // --- Helper Function to Display Errors ---
        const displayError = (message) => {
            authErrorMessage.textContent = message;
            authErrorMessage.style.display = 'block';
            setTimeout(() => {
                authErrorMessage.style.display = 'none';
            }, 5000); // Hide after 5 seconds
        };

        // --- Email/Password Login ---
        loginBtn.addEventListener('click', async () => {
            const email = emailInput.value;
            const password = passwordInput.value;
            if (!email || !password) {
                displayError('الرجاء إدخال البريد الإلكتروني وكلمة المرور.');
                return;
            }

            loadingOverlay.style.display = 'flex';
            try {
                await signInWithEmailAndPassword(auth, email, password);
                // Redirect handled by onAuthStateChanged
            } catch (error) {
                loadingOverlay.style.display = 'none';
                console.error("Login failed:", error.code, error.message);
                if (error.code === 'auth/invalid-credential' || error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password') {
                    displayError('البريد الإلكتروني أو كلمة المرور غير صحيحة.');
                } else if (error.code === 'auth/too-many-requests') {
                    displayError('لقد قمت بمحاولات عديدة لتسجيل الدخول. الرجاء المحاولة مرة أخرى لاحقًا.');
                } else {
                    displayError(`فشل تسجيل الدخول: ${error.message}`);
                }
            }
        });

        // --- Email/Password Registration ---
        registerBtn.addEventListener('click', async () => {
            const email = emailInput.value;
            const password = passwordInput.value;
            if (!email || !password) {
                displayError('الرجاء إدخال البريد الإلكتروني وكلمة المرور.');
                return;
            }
            if (password.length < 6) {
                displayError('كلمة المرور يجب أن تتكون من 6 أحرف على الأقل.');
                return;
            }

            loadingOverlay.style.display = 'flex';
            try {
                await createUserWithEmailAndPassword(auth, email, password);
                // Redirect handled by onAuthStateChanged
            } catch (error) {
                loadingOverlay.style.display = 'none';
                console.error("Registration failed:", error.code, error.message);
                if (error.code === 'auth/email-already-in-use') {
                    displayError('هذا البريد الإلكتروني مسجل بالفعل. الرجاء تسجيل الدخول أو استخدام بريد إلكتروني آخر.');
                } else if (error.code === 'auth/invalid-email') {
                    displayError('صيغة البريد الإلكتروني غير صحيحة.');
                } else if (error.code === 'auth/weak-password') {
                    displayError('كلمة المرور ضعيفة جدًا. الرجاء استخدام كلمة مرور أقوى.');
                } else {
                    displayError(`فشل إنشاء الحساب: ${error.message}`);
                }
            }
        });

        // --- Toggle between Login and Register Forms ---
        toggleFormLink.addEventListener('click', (e) => {
            e.preventDefault();
            isRegisterMode = !isRegisterMode;
            if (isRegisterMode) {
                loginBtn.style.display = 'none';
                registerBtn.style.display = 'block';
                toggleFormLink.textContent = 'لديك حساب بالفعل؟ تسجيل الدخول';
                document.querySelector('.login-container h1').textContent = 'إنشاء حساب جديد';
            } else {
                loginBtn.style.display = 'block';
                registerBtn.style.display = 'none';
                toggleFormLink.textContent = 'ليس لديك حساب؟ إنشاء حساب جديد';
                document.querySelector('.login-container h1').textContent = 'تسجيل الدخول إلى حكايتنا';
            }
            authErrorMessage.style.display = 'none'; // Clear error message on toggle
        });

        // --- Social Login Handlers ---
        googleLoginBtn.addEventListener('click', async () => {
            const provider = new GoogleAuthProvider();
            loadingOverlay.style.display = 'flex';
            try {
                await signInWithPopup(auth, provider);
                // Redirect handled by onAuthStateChanged
            } catch (error) {
                loadingOverlay.style.display = 'none';
                console.error("Google login failed:", error.code, error.message);
                if (error.code === 'auth/popup-closed-by-user') {
                    displayError('تم إغلاق نافذة تسجيل الدخول.');
                } else if (error.code === 'auth/cancelled-popup-request') {
                    displayError('تم إلغاء طلب تسجيل الدخول.');
                } else if (error.code === 'auth/auth-domain-config-required') {
                    displayError('خطأ في إعدادات المجال (Domain). الرجاء التحقق من إعدادات Firebase.');
                } else {
                    displayError(`فشل تسجيل الدخول عبر جوجل: ${error.message}`);
                }
            }
        });

        facebookLoginBtn.addEventListener('click', async () => {
            const provider = new FacebookAuthProvider();
            loadingOverlay.style.display = 'flex';
            try {
                // Request additional permissions if needed (e.g., 'public_profile', 'email')
                // provider.addScope('public_profile');
                // provider.addScope('email');
                await signInWithPopup(auth, provider);
                // Redirect handled by onAuthStateChanged
            } catch (error) {
                loadingOverlay.style.display = 'none';
                console.error("Facebook login failed:", error.code, error.message);
                if (error.code === 'auth/popup-closed-by-user') {
                    displayError('تم إغلاق نافذة تسجيل الدخول.');
                } else if (error.code === 'auth/cancelled-popup-request') {
                    displayError('تم إلغاء طلب تسجيل الدخول.');
                } else if (error.code === 'auth/auth-domain-config-required') {
                    displayError('خطأ في إعدادات المجال (Domain). الرجاء التحقق من إعدادات Firebase.');
                } else if (error.code === 'auth/account-exists-with-different-credential') {
                    displayError('هذا البريد الإلكتروني مسجل بالفعل بطريقة أخرى. الرجاء تسجيل الدخول بالطريقة الأصلية.');
                }
                else {
                    displayError(`فشل تسجيل الدخول عبر فيسبوك: ${error.message}`);
                }
            }
        });

        twitterLoginBtn.addEventListener('click', async () => {
            const provider = new TwitterAuthProvider();
            loadingOverlay.style.display = 'flex';
            try {
                await signInWithPopup(auth, provider);
                // Redirect handled by onAuthStateChanged
            } catch (error) {
                loadingOverlay.style.display = 'none';
                console.error("Twitter login failed:", error.code, error.message);
                if (error.code === 'auth/popup-closed-by-user') {
                    displayError('تم إغلاق نافذة تسجيل الدخول.');
                } else if (error.code === 'auth/cancelled-popup-request') {
                    displayError('تم إلغاء طلب تسجيل الدخول.');
                } else if (error.code === 'auth/auth-domain-config-required') {
                    displayError('خطأ في إعدادات المجال (Domain). الرجاء التحقق من إعدادات Firebase.');
                } else if (error.code === 'auth/account-exists-with-different-credential') {
                    displayError('هذا البريد الإلكتروني مسجل بالفعل بطريقة أخرى. الرجاء تسجيل الدخول بالطريقة الأصلية.');
                } else {
                    displayError(`فشل تسجيل الدخول عبر X (تويتر): ${error.message}`);
                }
            }
        });

        // Initially show loading overlay until Firebase auth state is determined
        loadingOverlay.style.display = 'flex';
    </script>
</body>
</html>
